<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D视频播放器 | 左右格式 & 红蓝立体</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#00C48C',
            dark: '#1E293B',
            light: '#F8FAFC'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .bg-gradient-dark {
        background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
      }
      .transition-all-300 {
        transition: all 0.3s ease;
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-900 text-light min-h-screen flex flex-col">
  <!-- 页面头部 -->
  <header class="bg-dark/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-800">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-play-circle text-primary text-2xl"></i>
        <h1 class="text-xl font-bold">3D<span class="text-primary">Vision</span>播放器</h1>
      </div>
      <nav class="hidden md:flex items-center space-x-6">
        <a href="#" class="text-gray-300 hover:text-primary transition-all-300">首页</a>
        <a href="#" class="text-gray-300 hover:text-primary transition-all-300">3D片库</a>
        <a href="#" class="text-gray-300 hover:text-primary transition-all-300">使用教程</a>
        <a href="#" class="text-gray-300 hover:text-primary transition-all-300">关于我们</a>
      </nav>
      <button class="md:hidden text-gray-300 focus:outline-none">
        <i class="fa fa-bars text-xl"></i>
      </button>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-grow container mx-auto px-4 py-6">
    <div class="mb-6">
      <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-2 text-shadow">3D视频播放器</h2>
      <p class="text-gray-400">支持左右格式3D视频和红蓝立体模式</p>
    </div>

    <!-- 视频播放器容器 -->
    <div class="relative bg-black rounded-xl overflow-hidden shadow-2xl max-w-5xl mx-auto">
      <!-- 视频画布 -->
      <canvas id="glCanvas" class="w-full aspect-video bg-gradient-to-r from-gray-900 to-gray-800"></canvas>
      
      <!-- 加载指示器 -->
      <div id="loadingIndicator" class="absolute inset-0 flex items-center justify-center bg-black/70 z-10">
        <div class="flex flex-col items-center">
          <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
          <p class="mt-4 text-gray-300">正在加载视频...</p>
        </div>
      </div>
      
      <!-- 控制栏 -->
      <div id="controls" class="absolute bottom-0 left-0 right-0 bg-gradient-dark p-4 opacity-0 hover:opacity-100 transition-all duration-300 z-20">
        <!-- 进度条 -->
        <div class="relative h-1 bg-gray-600 rounded-full mb-4 cursor-pointer group" id="progressBar">
          <div class="absolute left-0 top-0 h-full w-0 bg-primary rounded-full" id="progressFilled"></div>
          <div class="absolute left-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-all" id="progressHandle"></div>
        </div>
        
        <!-- 播放控制 -->
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <button id="playPauseBtn" class="text-white hover:text-primary transition-all-300">
              <i class="fa fa-play text-xl"></i>
            </button>
            <button id="muteBtn" class="text-white hover:text-primary transition-all-300">
              <i class="fa fa-volume-up"></i>
            </button>
            <div class="relative w-16 h-1 bg-gray-600 rounded-full cursor-pointer" id="volumeBar">
              <div class="absolute left-0 top-0 h-full w-3/4 bg-white rounded-full" id="volumeFilled"></div>
            </div>
          </div>
          
          <div class="flex items-center space-x-2 text-sm text-gray-300">
            <span id="currentTime">00:00</span>
            <span>/</span>
            <span id="totalTime">00:00</span>
          </div>
          
          <div class="flex items-center space-x-4">
            <button id="3dModeBtn" class="text-white hover:text-primary transition-all-300 flex items-center">
              <i class="fa fa-cubes mr-1"></i>
              <span>左右3D</span>
            </button>
            <button id="fullscreenBtn" class="text-white hover:text-primary transition-all-300">
              <i class="fa fa-expand"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 视频选择器 -->
    <div class="mt-8 bg-dark/50 rounded-xl p-6 border border-gray-800">
      <h3 class="text-xl font-semibold mb-4">选择示例视频</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="video-option bg-gray-800/50 rounded-lg overflow-hidden cursor-pointer hover:bg-gray-800 transition-all-300 border border-primary" data-video="sample">
          <div class="aspect-video bg-gray-900 flex items-center justify-center">
            <img src="https://picsum.photos/seed/3d1/400/225" alt="示例3D视频缩略图" class="w-full h-full object-cover">
          </div>
          <div class="p-3">
            <h4 class="font-medium">3D示例视频</h4>
            <p class="text-sm text-gray-400">左右格式 | 1920x1080</p>
          </div>
        </div>
        <div class="video-option bg-gray-800/50 rounded-lg overflow-hidden cursor-pointer hover:bg-gray-800 transition-all-300" data-video="custom">
          <div class="aspect-video bg-gray-900 flex items-center justify-center">
            <i class="fa fa-upload text-4xl text-gray-600"></i>
          </div>
          <div class="p-3">
            <h4 class="font-medium">上传自定义视频</h4>
            <p class="text-sm text-gray-400">支持MP4, WebM格式</p>
          </div>
        </div>
        <div class="video-option bg-gray-800/50 rounded-lg overflow-hidden cursor-pointer hover:bg-gray-800 transition-all-300" data-video="url">
          <div class="aspect-video bg-gray-900 flex items-center justify-center">
            <i class="fa fa-link text-4xl text-gray-600"></i>
          </div>
          <div class="p-3">
            <h4 class="font-medium">输入视频URL</h4>
            <p class="text-sm text-gray-400">支持在线视频链接</p>
          </div>
        </div>
      </div>
      
      <!-- 自定义视频输入 -->
      <div id="customVideoInput" class="mt-6 hidden">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-300 mb-2">上传视频文件</label>
          <input type="file" id="videoFileInput" accept="video/mp4,video/webm" class="block w-full text-sm text-gray-300 bg-gray-800 rounded-lg border border-gray-700 cursor-pointer p-2.5">
        </div>
      </div>
      
      <!-- 视频URL输入 -->
      <div id="videoUrlInput" class="mt-6 hidden">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-300 mb-2">输入视频URL</label>
          <div class="flex">
            <input type="text" id="videoUrl" placeholder="https://example.com/video.mp4" class="flex-grow bg-gray-800 border border-gray-700 rounded-l-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-sm">
            <button id="loadUrlBtn" class="bg-primary hover:bg-primary/90 text-white px-4 rounded-r-lg transition-all-300">
              加载
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 3D模式说明 -->
    <div class="mt-8 bg-dark/50 rounded-xl p-6 border border-gray-800">
      <h3 class="text-xl font-semibold mb-4">3D模式说明</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700">
          <div class="flex items-start">
            <div class="flex-shrink-0 w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center text-primary">
              <i class="fa fa-arrows-h"></i>
            </div>
            <div class="ml-4">
              <h4 class="font-medium mb-2">左右3D模式</h4>
              <p class="text-sm text-gray-400">视频的左右两侧分别包含左眼和右眼视图，需要使用偏振或快门式3D眼镜观看。</p>
            </div>
          </div>
        </div>
        <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700">
          <div class="flex items-start">
            <div class="flex-shrink-0 w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center text-primary">
              <i class="fa fa-eye"></i>
            </div>
            <div class="ml-4">
              <h4 class="font-medium mb-2">红蓝立体模式</h4>
              <p class="text-sm text-gray-400">将左右视图分别转换为红色和蓝色通道，使用红蓝3D眼镜观看（红色镜片对应左眼，蓝色镜片对应右眼）。</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-dark py-6 border-t border-gray-800 mt-10">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <div class="flex items-center space-x-2">
            <i class="fa fa-play-circle text-primary text-xl"></i>
            <span class="font-bold text-lg">3D<span class="text-primary">Vision</span>播放器</span>
          </div>
          <p class="text-gray-400 text-sm mt-1">体验沉浸式3D视频播放</p>
        </div>
        <div class="flex space-x-6">
          <a href="#" class="text-gray-400 hover:text-primary transition-all-300">
            <i class="fa fa-github text-xl"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-primary transition-all-300">
            <i class="fa fa-twitter text-xl"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-primary transition-all-300">
            <i class="fa fa-envelope text-xl"></i>
          </a>
        </div>
      </div>
      <div class="border-t border-gray-800 mt-6 pt-6 text-center text-gray-500 text-sm">
        &copy; 2023 3DVision播放器 | 使用HTML, WebGL和Tailwind CSS构建
      </div>
    </div>
  </footer>

  <!-- 主脚本 -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化WebGL和视频元素
      const canvas = document.getElementById('glCanvas');
      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      const loadingIndicator = document.getElementById('loadingIndicator');
      
      // 如果不支持WebGL，则显示错误
      if (!gl) {
        alert('无法初始化WebGL，您的浏览器可能不支持。');
        return;
      }
      
      // 创建视频元素
      const video = document.createElement('video');
      video.crossOrigin = 'anonymous';
      video.preload = 'auto';
      
      // 3D模式变量
      let isPlaying = false;
      let current3DMode = 'side-by-side'; // side-by-side 或 anaglyph
      let videoAspectRatio = 16/9;
      
      // 着色器代码
      const vertexShaderSource = `
        attribute vec4 a_position;
        attribute vec2 a_texCoord;
        
        varying vec2 v_texCoord;
        
        void main() {
          gl_Position = a_position;
          v_texCoord = a_texCoord;
        }
      `;
      
      // 左右格式3D的片段着色器
      const fragmentShaderSourceSideBySide = `

        
        uniform sampler2D u_texture;
        uniform bool u_isAnaglyph;
        uniform float u_videoAspectRatio;
        uniform float u_canvasAspectRatio;
        
        void main() {
          vec2 texCoord = gl_FragCoord.xy / vec2(u_canvasAspectRatio, 1.0);
          
          // 调整纹理坐标以适应视频宽高比
          texCoord.y = 1.0 - texCoord.y;
          
          // 左右格式3D - 左侧为左眼，右侧为右眼
          if (u_isAnaglyph) {
            // 红蓝立体模式
            vec2 leftTexCoord = vec2(texCoord.x * 0.5, texCoord.y);  // 左半部分纹理
            vec2 rightTexCoord = vec2(0.5 + texCoord.x * 0.5, texCoord.y);  // 右半部分纹理
            
            vec4 leftColor = texture2D(u_texture, leftTexCoord);
            vec4 rightColor = texture2D(u_texture, rightTexCoord);
            
            // 红色通道给左眼，蓝色和绿色通道给右眼
            gl_FragColor = vec4(leftColor.r, rightColor.g, rightColor.b, 1.0);
          } else {
            // 普通左右3D模式
            if (texCoord.x < 0.5) {
              // 左半部分显示左眼视图
              texCoord.x = texCoord.x * 2.0;
              gl_FragColor = texture2D(u_texture, texCoord);
            } else {
              // 右半部分显示右眼视图
              texCoord.x = (texCoord.x - 0.5) * 2.0;
              gl_FragColor = texture2D(u_texture, texCoord);
            }
          }
        }
      `;
      
      // 创建着色器程序
      function createShader(gl, type, source) {
        const shader = gl.createShader(type);
        gl.shaderSource(shader, source);
        gl.compileShader(shader);
        
        const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
        if (success) {
          return shader;
        }
        
        console.error(gl.getShaderInfoLog(shader));
        gl.deleteShader(shader);
        return null;
      }
      
      function createProgram(gl, vertexShader, fragmentShader) {
        const program = gl.createProgram();
        gl.attachShader(program, vertexShader);
        gl.attachShader(program, fragmentShader);
        gl.linkProgram(program);
        
        const success = gl.getProgramParameter(program, gl.LINK_STATUS);
        if (success) {
          return program;
        }
        
        console.error(gl.getProgramInfoLog(program));
        gl.deleteProgram(program);
        return null;
      }
      
      // 创建着色器
      const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
      const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSourceSideBySide);
      
      // 创建着色器程序
      const program = createProgram(gl, vertexShader, fragmentShader);
      
      // 获取属性和统一变量的位置
      const positionAttributeLocation = gl.getAttribLocation(program, 'a_position');
      const texCoordAttributeLocation = gl.getAttribLocation(program, 'a_texCoord');
      const textureUniformLocation = gl.getUniformLocation(program, 'u_texture');
      const isAnaglyphUniformLocation = gl.getUniformLocation(program, 'u_isAnaglyph');
      const videoAspectRatioUniformLocation = gl.getUniformLocation(program, 'u_videoAspectRatio');
      const canvasAspectRatioUniformLocation = gl.getUniformLocation(program, 'u_canvasAspectRatio');
      
      // 创建缓冲区
      const positionBuffer = gl.createBuffer();
      const texCoordBuffer = gl.createBuffer();
      
      // 设置顶点位置
      gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
      gl.bufferData(
        gl.ARRAY_BUFFER,
        new Float32Array([
          -1, -1,
           1, -1,
          -1,  1,
          -1,  1,
           1, -1,
           1,  1,
        ]),
        gl.STATIC_DRAW
      );
      
      // 设置纹理坐标
      gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);
      gl.bufferData(
        gl.ARRAY_BUFFER,
        new Float32Array([
          0, 1,
          1, 1,
          0, 0,
          0, 0,
          1, 1,
          1, 0,
        ]),
        gl.STATIC_DRAW
      );
      
      // 创建纹理
      const texture = gl.createTexture();
      gl.bindTexture(gl.TEXTURE_2D, texture);
      
      // 设置纹理参数
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
      
      // 调整画布大小
      function resizeCanvasToDisplaySize() {
        const displayWidth = canvas.clientWidth;
        const displayHeight = canvas.clientHeight;
        
        if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
          canvas.width = displayWidth;
          canvas.height = displayHeight;
          gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
        }
      }
      
      // 渲染函数
      function render() {
        resizeCanvasToDisplaySize();
        
        // 清除画布
        gl.clearColor(0, 0, 0, 1);
        gl.clear(gl.COLOR_BUFFER_BIT);
        
        // 使用着色器程序
        gl.useProgram(program);
        
        // 设置顶点属性
        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
        gl.enableVertexAttribArray(positionAttributeLocation);
        gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);
        
        // 设置纹理坐标属性
        gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);
        gl.enableVertexAttribArray(texCoordAttributeLocation);
        gl.vertexAttribPointer(texCoordAttributeLocation, 2, gl.FLOAT, false, 0, 0);
        
        // 激活纹理单元0
        gl.activeTexture(gl.TEXTURE0);
        gl.bindTexture(gl.TEXTURE_2D, texture);
        
        // 如果视频已加载，则更新纹理
        if (video.readyState >= video.HAVE_CURRENT_DATA) {
          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, video);
        }
        
        // 设置统一变量
        gl.uniform1i(textureUniformLocation, 0);
        gl.uniform1i(isAnaglyphUniformLocation, current3DMode === 'anaglyph');
        gl.uniform1f(videoAspectRatioUniformLocation, videoAspectRatio);
        gl.uniform1f(canvasAspectRatioUniformLocation, canvas.clientWidth / canvas.clientHeight);
        
        // 绘制三角形
        gl.drawArrays(gl.TRIANGLES, 0, 6);
        
        // 继续渲染下一帧
        requestAnimationFrame(render);
      }
      
      // 开始渲染循环
      render();
      
      // 视频加载完成事件
      video.addEventListener('loadedmetadata', function() {
        videoAspectRatio = video.videoWidth / video.videoHeight;
        loadingIndicator.style.display = 'none';
      });
      
      // 视频加载错误事件
      video.addEventListener('error', function() {
        loadingIndicator.style.display = 'none';
        alert('视频加载错误，请检查URL或文件格式。');
      });
      
      // 播放/暂停按钮
      const playPauseBtn = document.getElementById('playPauseBtn');
      playPauseBtn.addEventListener('click', function() {
        if (video.paused) {
          video.play().then(() => {
            isPlaying = true;
            playPauseBtn.innerHTML = '<i class="fa fa-pause text-xl"></i>';
          }).catch(error => {
            console.error('播放错误:', error);
          });
        } else {
          video.pause();
          isPlaying = false;
          playPauseBtn.innerHTML = '<i class="fa fa-play text-xl"></i>';
        }
      });
      
      // 静音按钮
      const muteBtn = document.getElementById('muteBtn');
      muteBtn.addEventListener('click', function() {
        video.muted = !video.muted;
        muteBtn.innerHTML = video.muted ? '<i class="fa fa-volume-off"></i>' : '<i class="fa fa-volume-up"></i>';
      });
      
      // 3D模式切换按钮
      const modeBtn = document.getElementById('3dModeBtn');
      modeBtn.addEventListener('click', function() {
        current3DMode = current3DMode === 'side-by-side' ? 'anaglyph' : 'side-by-side';
        modeBtn.innerHTML = current3DMode === 'side-by-side' ? 
          '<i class="fa fa-arrows-h mr-1"></i><span>左右3D</span>' : 
          '<i class="fa fa-eye mr-1"></i><span>红蓝立体</span>';
      });
      
      // 全屏按钮
      const fullscreenBtn = document.getElementById('fullscreenBtn');
      fullscreenBtn.addEventListener('click', function() {
        const videoContainer = canvas.parentElement;
        if (!document.fullscreenElement) {
          if (videoContainer.requestFullscreen) {
            videoContainer.requestFullscreen();
          } else if (videoContainer.webkitRequestFullscreen) {
            videoContainer.webkitRequestFullscreen();
          } else if (videoContainer.msRequestFullscreen) {
            videoContainer.msRequestFullscreen();
          }
          fullscreenBtn.innerHTML = '<i class="fa fa-compress"></i>';
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          }
          fullscreenBtn.innerHTML = '<i class="fa fa-expand"></i>';
        }
      });
      
      // 视频选择选项
      const videoOptions = document.querySelectorAll('.video-option');
      const customVideoInput = document.getElementById('customVideoInput');
      const videoUrlInput = document.getElementById('videoUrlInput');
      
      videoOptions.forEach(option => {
        option.addEventListener('click', function() {
          const type = this.dataset.video;
          
          // 隐藏所有输入区域
          customVideoInput.classList.add('hidden');
          videoUrlInput.classList.add('hidden');
          
          // 重置所有选项的样式
          videoOptions.forEach(opt => {
            opt.classList.remove('border-primary');
          });
          
          // 显示选中的输入区域并添加样式
          this.classList.add('border-primary');
          
          if (type === 'custom') {
            customVideoInput.classList.remove('hidden');
          } else if (type === 'url') {
            videoUrlInput.classList.remove('hidden');
          } else if (type === 'sample') {
            // 加载示例视频
            loadSampleVideo();
          }
        });
      });
      
      // 加载示例视频
      function loadSampleVideo() {
        loadingIndicator.style.display = 'flex';
        // 使用示例视频URL，实际使用时请替换为真实的3D视频
        video.src = 'https://storage.googleapis.com/webglfundamentals.org/demos/resources/chrome.mp4';
        video.load();
        video.play().then(() => {
          isPlaying = true;
          playPauseBtn.innerHTML = '<i class="fa fa-pause text-xl"></i>';
        }).catch(error => {
          console.error('播放错误:', error);
        });
      }
      
      // 文件上传
      const videoFileInput = document.getElementById('videoFileInput');
      videoFileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const videoType = file.type;
          if (videoType.startsWith('video/')) {
            loadingIndicator.style.display = 'flex';
            const videoURL = URL.createObjectURL(file);
            video.src = videoURL;
            video.load();
            video.play().then(() => {
              isPlaying = true;
              playPauseBtn.innerHTML = '<i class="fa fa-pause text-xl"></i>';
            }).catch(error => {
              console.error('播放错误:', error);
            });
          } else {
            alert('请选择视频文件');
          }
        }
      });
      
      // URL加载
      const videoUrl = document.getElementById('videoUrl');
      const loadUrlBtn = document.getElementById('loadUrlBtn');
      
      loadUrlBtn.addEventListener('click', function() {
        const url = videoUrl.value.trim();
        if (url) {
          loadingIndicator.style.display = 'flex';
          video.src = url;
          video.load();
          video.play().then(() => {
            isPlaying = true;
            playPauseBtn.innerHTML = '<i class="fa fa-pause text-xl"></i>';
          }).catch(error => {
            console.error('播放错误:', error);
          });
        }
      });
      
      // 进度条更新
      video.addEventListener('timeupdate', function() {
        const percent = (video.currentTime / video.duration) * 100;
        document.getElementById('progressFilled').style.width = `${percent}%`;
        document.getElementById('currentTime').textContent = formatTime(video.currentTime);
        document.getElementById('totalTime').textContent = formatTime(video.duration);
      });
      
      // 格式化时间
      function formatTime(seconds) {
        if (isNaN(seconds)) return '00:00';
        const minutes = Math.floor(seconds / 60);
        seconds = Math.floor(seconds % 60);
        return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }
      
      // 进度条点击
      const progressBar = document.getElementById('progressBar');
      progressBar.addEventListener('click', function(e) {
        const rect = this.getBoundingClientRect();
        const pos = (e.clientX - rect.left) / rect.width;
        video.currentTime = pos * video.duration;
      });
      
      // 显示控制栏
      canvas.addEventListener('mousemove', function() {
        document.getElementById('controls').style.opacity = '1';
        clearTimeout(this.controlTimeout);
        this.controlTimeout = setTimeout(() => {
          if (isPlaying) {
            document.getElementById('controls').style.opacity = '0';
          }
        }, 3000);
      });
      
      // 初始化加载示例视频
      loadSampleVideo();
    });
  </script>
</body>
</html>
    